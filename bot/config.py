# ========================================================
# –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ë–û–¢–ê VK
# ========================================================

import os
from dotenv import load_dotenv

# –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª .env –∏–∑ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏–ª–∏ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
# –í–ê–ñ–ù–û: –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —á–µ—Ä–µ–∑ 'python -m bot.bot' –∏–∑ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –ø–∞–ø–∫–∏,
# __file__ –±—É–¥–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ bot/config.py, –ø–æ—ç—Ç–æ–º—É –Ω—É–∂–Ω–æ –∏—Å–∫–∞—Ç—å .env
# –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —ç—Ç–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏–ª–∏ –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π.
current_dir = os.path.dirname(os.path.abspath(__file__))
parent_dir = os.path.dirname(current_dir)
env_path_in_parent = os.path.join(parent_dir, '.env')

if os.path.exists(env_path_in_parent):
    load_dotenv(env_path_in_parent)
    print(f"Loaded .env from: {env_path_in_parent}")
elif os.path.exists(os.path.join(current_dir, '.env')): # –ú–µ–Ω–µ–µ –≤–µ—Ä–æ—è—Ç–Ω–æ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —á–µ—Ä–µ–∑ -m
    load_dotenv(os.path.join(current_dir, '.env'))
    print(f"Loaded .env from: {current_dir}")
else:
    print(f"Warning: .env file not found. Looked in {parent_dir} and {current_dir}. Create one from .env.example")

# –¢–æ–∫–µ–Ω VK API –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ API –í–ö–æ–Ω—Ç–∞–∫—Ç–µ
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –±–æ—Ç–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏/–ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
# –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –º–æ–∂–Ω–æ –Ω–∞ https://vk.com/dev/bots_docs
# –•—Ä–∞–Ω–∏—Ç—Å—è –≤ .env —Ñ–∞–π–ª–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ: VK_TOKEN=your_token_here
VK_TOKEN = os.getenv("VK_TOKEN")

# --- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π --- #

# ID –±–µ—Å–µ–¥—ã –í–ö–æ–Ω—Ç–∞–∫—Ç–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –∑–∞—è–≤–∫–∞—Ö
# ID –±–µ—Å–µ–¥ –æ–±—ã—á–Ω–æ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å 2000000000
# –£–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ .env —Ñ–∞–π–ª–µ: NOTIFICATION_CHAT_ID=2000000001
NOTIFICATION_CHAT_ID_RAW = os.getenv("NOTIFICATION_CHAT_ID", "")
NOTIFICATION_CHAT_ID = None
if NOTIFICATION_CHAT_ID_RAW:
    try:
        NOTIFICATION_CHAT_ID = int(NOTIFICATION_CHAT_ID_RAW)
        if NOTIFICATION_CHAT_ID < 2000000000:
             print(f"Warning: NOTIFICATION_CHAT_ID ({NOTIFICATION_CHAT_ID}) looks like a user ID, not a chat ID. Chat IDs usually start from 2000000000.")
    except ValueError:
        print(f"Warning: NOTIFICATION_CHAT_ID in .env is not a valid integer: '{NOTIFICATION_CHAT_ID_RAW}'. Notifications will be disabled.")

# ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤/–º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ü–µ–ª–µ–π)
ADMIN_IDS_RAW = os.getenv("ADMIN_IDS", "")
ADMIN_IDS = []
if ADMIN_IDS_RAW:
    try:
        ADMIN_IDS = [int(admin_id.strip()) for admin_id in ADMIN_IDS_RAW.split(',') if admin_id.strip()]
    except ValueError:
        print(f"Warning: ADMIN_IDS in .env contains non-integer values: '{ADMIN_IDS_RAW}'.")

# –®–∞–±–ª–æ–Ω —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤–æ–π –∑–∞—è–≤–∫–µ
# –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã: {ticket_id}, {user_id}, {user_link}, {field_name} (–¥–ª—è –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã)
NEW_TICKET_NOTIFICATION_TEMPLATE = os.getenv(
    "NEW_TICKET_NOTIFICATION_TEMPLATE",
    "üîî –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞! üîî\n\nID –∑–∞—è–≤–∫–∏: {ticket_id}\n–û—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {user_link}\n\n{form_summary}"
)

# –®–∞–±–ª–æ–Ω —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –æ–± —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞—è–≤–∫–∏
# –ü–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã: {ticket_id}, {user_id}, {user_link}
TICKET_DELETED_NOTIFICATION_TEMPLATE = os.getenv(
    "TICKET_DELETED_NOTIFICATION_TEMPLATE",
    "üóëÔ∏è –ó–∞—è–≤–∫–∞ —É–¥–∞–ª–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º üóëÔ∏è\n\nID –∑–∞—è–≤–∫–∏: {ticket_id}\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {user_link}"
)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ç–æ–∫–µ–Ω–∞
if not VK_TOKEN:
    raise ValueError("VK_TOKEN not found in .env file. Please configure your environment variables.")

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è ID —á–∞—Ç–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
if not NOTIFICATION_CHAT_ID:
    print("Warning: NOTIFICATION_CHAT_ID is not configured or invalid in .env. Admin notifications will be disabled.")

# ========================================================
# –ù–ê–°–¢–†–û–ô–ö–ê –§–û–†–ú–´ –ó–ê–Ø–í–ö–ò
# ========================================================

# –°–ø–∏—Å–æ–∫ –ø–æ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å—Å—è —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ñ–æ—Ä–º—ã
# –ü–æ—Ä—è–¥–æ–∫ –ø–æ–ª–µ–π –≤ —Å–ø–∏—Å–∫–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏
FORM_FIELDS = [
    "–í–∞—à–µ –∏–º—è",                                     # –ò–º—è –∫–æ–Ω—Ç–∞–∫—Ç–Ω–æ–≥–æ –ª–∏—Ü–∞
    "–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞",                            # Email –¥–ª—è —Å–≤—è–∑–∏
    "–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞",                               # –¢–µ–ª–µ—Ñ–æ–Ω –¥–ª—è —Å–≤—è–∑–∏
    "–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏",                            # –ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞
    "–°–∞–π—Ç/CRM-—Å–∏—Å—Ç–µ–º–∞/–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ/–î—Ä—É–≥–æ–µ", # –¢–∏–ø –ø—Ä–æ–µ–∫—Ç–∞
    "–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ",                             # –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
    "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"                     # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏–ª–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è
]

# ========================================================
# –¢–ï–ö–°–¢–û–í–´–ï –°–û–û–ë–©–ï–ù–ò–Ø –ë–û–¢–ê
# ========================================================

# –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∫–æ–Ω—Ç–∞–∫—Ç–µ —Å –±–æ—Ç–æ–º
WELCOME_MESSAGE = "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –Ø –º–æ–≥—É –ø–æ–º–æ—á—å –≤–∞–º —Å–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ –∑–∞–∫–∞–∑ —Å–∞–π—Ç–∞ –∏–ª–∏ IT-–ø—Ä–æ–¥—É–∫—Ç–∞."

# –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –Ω–∞—á–∞–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—ã
FORM_START_MESSAGE = "–û—Ç–ª–∏—á–Ω–æ! –î–∞–≤–∞–π—Ç–µ –Ω–∞—á–Ω–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã. –Ø –±—É–¥—É –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ –æ–¥–Ω–æ–º—É."

# –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—ã –∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞—è–≤–∫–∏
FORM_COMPLETE_MESSAGE = "–°–ø–∞—Å–∏–±–æ! –í–∞—à–∞ –∑–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞. –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è."

# –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—ã
CANCEL_MESSAGE = """–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã –æ—Ç–º–µ–Ω–µ–Ω–æ. –ù–∞–∂–º–∏—Ç–µ "–ó–∞–ø–æ–ª–Ω–∏—Ç—å –∑–∞—è–≤–∫—É" –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Å–Ω–æ–≤–∞.""" 